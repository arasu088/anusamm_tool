<p id="notice"><%= notice %></p>

<h1 class="form_div">Escalation</h1>
<%= form_tag escalation_index_path, method: :get do %> 
  <div class="row form_div">
    <div class="col-xs-2 col-sm-2 col-md-2 col-lg-2">
      <%=select_tag 'project_id', options_for_select(Project.where("is_active=1").collect{ |u| [u.name, u.id] },params[:project_id]), {:prompt => "--select project--",:style=>"width:100%"}%>
    </div>
    <div class="col-xs-2 col-sm-2 col-md-2 col-lg-2">
      <%= submit_tag "search"%>
      <%= button_to "clear",escalation_index_path, :method => :get,:onclick=>"reload()" %>
    </div>             
  </div>
  <% end %>
<table id="escalation_tbl" class="form_div table table-striped table-condensed" style="width:90%">
  <thead>
    <tr>
      <th>Project</th>
      <th>Material</th>
      <th>ABS Qty</th>
      <th>ABS Rate</th>
      <th>Est Expense</th>
      <th>Purchase Qty</th>
      <th>Purchase Rate</th>
      <th>Site Expense</th>
      <th>Escalation Amt</th>
    </tr>
  </thead>

  <tbody>
  <%if @escalations.present?%>
    <% @escalations.each do |escalation| %>
      <tr>
        <td><%= escalation.project_name %></td>
        <td><%= escalation.material_name %></td>
        <td><%= escalation.abs_quantity.tap{|x| break x.to_i == x ? x.to_i : x} %></td>
        <td><%= escalation.abs_amount.tap{|x| break x.to_i == x ? x.to_i : x} %></td>
        <td><%= escalation.est_expense.tap{|x| break x.to_i == x ? x.to_i : x} %></td>
        <td><%= escalation.purchase_quantity.tap{|x| break x.to_i == x ? x.to_i : x} %></td>
        <td><%= escalation.purchase_rate.tap{|x| break x.to_i == x ? x.to_i : x} %></td>
        <td><%= escalation.site_expense.tap{|x| break x.to_i == x ? x.to_i : x} %></td>
        <%@total+=escalation.escalation_amount%>
        <td><%= escalation.escalation_amount.tap{|x| break x.to_i == x ? x.to_i : x} %></td>
      </tr>
    <% end %>
    <tr>
      <th colspan="7"></th>
      <th>Total</th>
      <th><%=@total.tap{|x| break x.to_i == x ? x.to_i : x}%></th>
    </tr>
  <% else %>
    <tr>
    <th colspan="9">No Records Found</th>
    </tr>
  <% end %>     
  </tbody>
</table>

<br>

<script>
function reload() {
  jQuery("#project_id").val('')
    }
</script>
